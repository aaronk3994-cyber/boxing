<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Elite Boxer: Berserker Evolution</title>
    <style>
        body { background: #121212; color: white; font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; overflow: hidden; }
        canvas { background: #1a1a1a; border: 5px solid #333; box-shadow: 0 0 50px #000; border-radius: 8px; }
        .menu-overlay { position: absolute; background: rgba(0,0,0,0.95); width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10; top: 0; left: 0; text-align: center; overflow-y: auto; }
        .stat-row, .shop-row { margin: 8px; display: flex; gap: 10px; align-items: center; justify-content: center; }
        button { padding: 8px 16px; cursor: pointer; background: #e74c3c; color: white; border: none; font-weight: bold; border-radius: 4px; transition: 0.2s; }
        button:hover { background: #ff4757; transform: scale(1.05); }
        button:disabled { background: #444; cursor: not-allowed; }
        .gold-text { color: #f1c40f; font-weight: bold; font-size: 20px; margin: 5px; }
        .section-title { border-bottom: 2px solid #444; width: 60%; margin: 10px 0; padding-bottom: 5px; color: #aaa; text-transform: uppercase; font-size: 14px; }
    </style>
</head>
<body>
    <div id="game-wrapper" style="position: relative;">
        <canvas id="gameCanvas" width="800" height="400"></canvas>
        <div id="menu" class="menu-overlay">
            <h1 style="margin: 10px 0;">BERSERKER EVOLUTION</h1>
            <div class="gold-text">GOLD: <span id="goldVal">0</span> | STREAK: <span id="streakVal">0</span></div>
            
            <div class="section-title">Train Stats</div>
            <div class="stat-row">
                <span>STR: <b id="lvlStr">1</b></span> <button onclick="upgrade('str')">Train (50G)</button>
                <span>VIT: <b id="lvlHp">1</b></span> <button onclick="upgrade('hp')">Train (50G)</button>
                <span>AGI: <b id="lvlSpd">1</b></span> <button onclick="upgrade('spd')">Train (50G)</button>
            </div>

            <div class="section-title">Equipment Store</div>
            <div class="shop-row">
                <button id="btnRed" onclick="buySkin('red', 200)">Red Gloves (200G)</button>
                <button id="btnGold" onclick="buySkin('gold', 1000)">Gold Gloves (1000G)</button>
                <button id="btnGreen" onclick="buySkin('lime', 500)">Emerald (500G)</button>
            </div>

            <button id="startBtn" style="background:#2ecc71; margin-top:20px; font-size:20px; padding: 15px 40px;" onclick="startGame()">ENTER THE RING</button>
            <p style="font-size: 12px; color: #666;">A/D: Move | Space: Punch | S: Special Attack (50 Rage)</p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const menu = document.getElementById("menu");

        // Load Stats & Skins
        let stats = JSON.parse(localStorage.getItem('boxerStats')) || { 
            gold: 0, str: 1, hp: 1, spd: 1, streak: 0, 
            skins: ['cyan'], activeSkin: 'cyan' 
        };

        function save() { 
            localStorage.setItem('boxerStats', JSON.stringify(stats)); 
            document.getElementById('goldVal').innerText = stats.gold;
            document.getElementById('lvlStr').innerText = stats.str;
            document.getElementById('lvlHp').innerText = stats.hp;
            document.getElementById('lvlSpd').innerText = stats.spd;
            document.getElementById('streakVal').innerText = stats.streak;
            updateShopButtons();
        }

        function upgrade(type) { if (stats.gold >= 50) { stats.gold -= 50; stats[type]++; save(); } }

        function buySkin(color, price) {
            if (stats.skins.includes(color)) {
                stats.activeSkin = color;
            } else if (stats.gold >= price) {
                stats.gold -= price;
                stats.skins.push(color);
                stats.activeSkin = color;
            }
            save();
        }

        function updateShopButtons() {
            const colors = { red: 'btnRed', gold: 'btnGold', lime: 'btnGreen' };
            for (let c in colors) {
                let btn = document.getElementById(colors[c]);
                if (stats.skins.includes(c)) {
                    btn.innerText = (stats.activeSkin === c) ? "EQUIPPED" : "EQUIP";
                    btn.style.background = (stats.activeSkin === c) ? "#2980b9" : "#7f8c8d";
                }
            }
        }

        class Particle {
            constructor(x, y, color) { this.x = x; this.y = y; this.vX = (Math.random()-0.5)*10; this.vY = (Math.random()-0.5)*10; this.alpha = 1; this.color = color; }
            update() { this.x += this.vX; this.y += this.vY; this.alpha -= 0.02; }
            draw() { ctx.globalAlpha = this.alpha; ctx.fillStyle = this.color; ctx.fillRect(this.x, this.y, 4, 4); ctx.globalAlpha = 1; }
        }

        class Fighter {
            constructor(x, color, side, isAI, isBoss = false) {
                this.x = x; this.y = isBoss ? 185 : 240; this.w = isBoss ? 100 : 60; this.h = isBoss ? 165 : 110;
                this.color = color; this.side = side; this.isAI = isAI; this.isBoss = isBoss;
                this.maxHp = isAI ? (isBoss ? 600 : 100 + (stats.streak*15)) : 100 + (stats.hp * 10);
                this.hp = this.maxHp;
                this.speed = isAI ? (isBoss ? 3 : 4) : 4 + (stats.spd * 0.5);
                this.velY = 0; this.velX = 0; this.rage = 0; this.isBerserk = false; this.berserkTimer = 0;
            }
            update() {
                this.y += this.velY; this.x += this.velX; this.velX *= 0.85;
                let groundY = this.isBoss ? 185 : 240;
                if (this.y < groundY) { this.velY += 1.2; } else { this.y = groundY; this.velY = 0; }
                if (this.isBerserk) { this.berserkTimer--; if (this.berserkTimer <= 0) this.isBerserk = false; }
            }
            draw() {
                if (this.isBerserk) { ctx.shadowBlur = 20; ctx.shadowColor = "red"; ctx.fillStyle = "#ff4757"; } 
                else { ctx.shadowBlur = 0; ctx.fillStyle = this.color; }
                ctx.fillRect(this.x, this.y, this.w, this.h);
                
                // Draw Gloves
                ctx.fillStyle = (this.side === 'left') ? stats.activeSkin : 'white';
                let gx = this.side === 'left' ? this.x + this.w - 10 : this.x - 5;
                ctx.fillRect(gx, this.y + 30, 15, 15);

                ctx.shadowBlur = 0;
                let bx = this.side === "left" ? 20 : 580;
                ctx.fillStyle = "#333"; ctx.fillRect(bx, 20, 200, 15);
                ctx.fillStyle = this.isBoss ? "purple" : "red"; ctx.fillRect(bx, 20, (this.hp / this.maxHp) * 200, 15);
                ctx.fillStyle = "#ff9f43"; ctx.fillRect(bx, 40, this.rage * 2, 5);
            }
        }

        let p1, cpu, keys = {}, particles = [], gameState = "MENU", winner = null;
        window.onkeydown = (e) => keys[e.code] = true;
        window.onkeyup = (e) => keys[e.code] = false;

        function startGame() { 
            gameState = "PLAY"; menu.style.display = "none";
            p1 = new Fighter(100, "#3498db", "left", false);
            const isBossNext = (stats.streak + 1) % 3 === 0;
            cpu = new Fighter(600, isBossNext ? "#8e44ad" : "#c0392b", "right", true, isBossNext);
            winner = null; 
        }

        function checkHit(atk, def, isSpecial = false) {
            let dist = Math.abs(atk.x - def.x);
            if (dist < (atk.isBoss ? 120 : 95)) {
                let damage = (isSpecial ? 30 : 10) + (atk.isAI ? (atk.isBoss ? 15 : 0) : stats.str * 3);
                def.hp -= damage; def.rage += 15;
                if (def.rage >= 100) { def.rage = 0; def.isBerserk = true; def.berserkTimer = 250; }
                for(let i=0; i<12; i++) particles.push(new Particle(def.x + 30, def.y + 40, isSpecial ? "orange" : "yellow"));
                def.velX = atk.side === "left" ? 20 : -20;
                if (def.hp <= 0) { 
                    winner = atk.side; 
                    if(!atk.isAI) { stats.gold += (cpu.isBoss ? 500 : 100); stats.streak++; } else { stats.streak = 0; }
                    save();
                }
            }
        }

        function gameLoop() {
            ctx.clearRect(0, 0, 800, 400);
            if (gameState === "PLAY") {
                if (winner) {
                    ctx.fillStyle = "white"; ctx.font = "40px Arial"; ctx.textAlign = "center";
                    ctx.fillText(winner === "left" ? "VICTORY!" : "DEFEAT", 400, 200);
                    setTimeout(() => { gameState = "MENU"; menu.style.display = "flex"; winner = null; }, 2000);
                } else {
                    let s = p1.isBerserk ? p1.speed * 1.6 : p1.speed;
                    if (keys['KeyA']) p1.x -= s; if (keys['KeyD']) p1.x += s;
                    if (keys['Space']) { checkHit(p1, cpu); keys['Space'] = false; }
                    if (keys['KeyS'] && p1.rage >= 50) { p1.rage -= 50; p1.velX = 50; checkHit(p1, cpu, true); keys['KeyS'] = false; }

                    let dist = Math.abs(cpu.x - p1.x);
                    if (dist > 100) cpu.x += (cpu.x > p1.x ? -cpu.speed : cpu.speed);
                    else if (dist < 70) cpu.x += (cpu.x > p1.x ? cpu.speed : -cpu.speed);
                    if (Math.random() < 0.05) checkHit(cpu, p1);
                    if (cpu.isBoss && Math.random() < 0.01) cpu.velY = -18;

                    p1.update(); cpu.update(); p1.draw(); cpu.draw();
                    particles.forEach((p, i) => { p.update(); p.draw(); if(p.alpha <= 0) particles.splice(i, 1); });
                }
            }
            requestAnimationFrame(gameLoop);
        }
        save();
        gameLoop();
    </script>
</body>
</html>
