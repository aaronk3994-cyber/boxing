<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Elite Boxer: Berserker Evolution</title>
    <style>
        body { background: #121212; color: white; font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; overflow: hidden; }
        canvas { background: #1a1a1a; border: 5px solid #333; box-shadow: 0 0 50px #000; border-radius: 8px; cursor: crosshair; }
        .menu-overlay { position: absolute; background: rgba(0,0,0,0.95); width: 800px; height: 400px; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 8px; text-align: center; z-index: 10; }
        .stat-row { margin: 10px; display: flex; gap: 15px; align-items: center; }
        button { padding: 10px 20px; cursor: pointer; background: #e74c3c; color: white; border: none; font-weight: bold; transition: 0.2s; border-radius: 4px; }
        button:hover { background: #ff4757; transform: scale(1.1); }
        .gold-text { color: #f1c40f; font-weight: bold; font-size: 24px; }
    </style>
</head>
<body>

    <div id="game-wrapper" style="position: relative;">
        <canvas id="gameCanvas" width="800" height="400"></canvas>
        
        <div id="menu" class="menu-overlay">
            <h1>FIGHTER EVOLUTION</h1>
            <p>Win fights to earn Gold and upgrade your stats!</p>
            <div class="gold-text">Gold: <span id="goldVal">0</span></div>
            
            <div class="stat-row">
                <span>Strength (Dmg) <b id="lvlStr">1</b></span>
                <button onclick="upgrade('str')">Upgrade (50G)</button>
            </div>
            <div class="stat-row">
                <span>Vitality (HP) <b id="lvlHp">1</b></span>
                <button onclick="upgrade('hp')">Upgrade (50G)</button>
            </div>
            <div class="stat-row">
                <span>Agility (Speed) <b id="lvlSpd">1</b></span>
                <button onclick="upgrade('spd')">Upgrade (50G)</button>
            </div>

            <button style="background:#2ecc71; margin-top:20px; font-size:20px;" onclick="startGame()">START FIGHT</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const menu = document.getElementById("menu");

        // --- 5. LEVELING SYSTEM (Local Storage) ---
        let stats = JSON.parse(localStorage.getItem('boxerStats')) || { gold: 0, str: 1, hp: 1, spd: 1 };

        function save() { 
            localStorage.setItem('boxerStats', JSON.stringify(stats)); 
            document.getElementById('goldVal').innerText = stats.gold;
            document.getElementById('lvlStr').innerText = stats.str;
            document.getElementById('lvlHp').innerText = stats.hp;
            document.getElementById('lvlSpd').innerText = stats.spd;
        }
        save();

        function upgrade(type) {
            if (stats.gold >= 50) {
                stats.gold -= 50; stats[type]++; save();
            }
        }

        // --- 6. PARTICLE SYSTEM ---
        let particles = [];
        class Particle {
            constructor(x, y, color) {
                this.x = x; this.y = y;
                this.vX = (Math.random() - 0.5) * 10;
                this.vY = (Math.random() - 0.5) * 10;
                this.alpha = 1; this.color = color;
            }
            update() { this.x += this.vX; this.y += this.vY; this.alpha -= 0.02; }
            draw() {
                ctx.globalAlpha = this.alpha; ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, 4, 4); ctx.globalAlpha = 1;
            }
        }

        let gameState = "MENU"; let winner = null;
        const weapons = { 'Gloves': { dmg: 8 + (stats.str * 2), range: 80 } };

        class Fighter {
            constructor(x, color, side, isAI) {
                this.x = x; this.y = 240; this.w = 60; this.h = 110;
                this.color = color; this.side = side; this.isAI = isAI;
                this.maxHp = isAI ? 100 : 100 + (stats.hp * 10);
                this.hp = this.maxHp;
                this.speed = isAI ? 4 : 4 + (stats.spd * 0.5);
                this.velY = 0; this.velX = 0;
                // --- 1. RAGE SYSTEM ---
                this.rage = 0; this.isBerserk = false; this.berserkTimer = 0;
            }

            update() {
                this.y += this.velY; this.x += this.velX; this.velX *= 0.85;
                if (this.y < 240) { this.velY += 1.2; } else { this.y = 240; this.velY = 0; }
                
                if (this.isBerserk) {
                    this.berserkTimer--;
                    if (this.berserkTimer <= 0) this.isBerserk = false;
                }
            }

            draw() {
                // Glow if Berserk
                if (this.isBerserk) {
                    ctx.shadowBlur = 20; ctx.shadowColor = "red";
                    ctx.fillStyle = "#ff4757";
                } else {
                    ctx.shadowBlur = 0; ctx.fillStyle = this.color;
                }
                ctx.fillRect(this.x, this.y, this.w, this.h);
                ctx.shadowBlur = 0;

                // HP and Rage bars
                let bx = this.side === "left" ? 20 : 580;
                ctx.fillStyle = "#333"; ctx.fillRect(bx, 20, 200, 15);
                ctx.fillStyle = "red"; ctx.fillRect(bx, 20, (this.hp / this.maxHp) * 200, 15);
                ctx.fillStyle = "#ff9f43"; ctx.fillRect(bx, 40, this.rage * 2, 5);
            }
        }

        let p1, cpu, keys = {};
        window.onkeydown = (e) => keys[e.code] = true;
        window.onkeyup = (e) => keys[e.code] = false;

        function startGame() { gameState = "PLAY"; menu.style.display = "none"; p1 = new Fighter(100, "cyan", "left", false); cpu = new Fighter(600, "red", "right", true); winner = null; }

        function checkHit(atk, def) {
            let d = Math.abs(atk.x - def.x);
            if (d < 90) {
                let damage = 10 + (atk.isAI ? 0 : stats.str * 2);
                def.hp -= damage;
                def.rage += 15; // Gain rage when hit
                if (def.rage >= 100) { def.rage = 0; def.isBerserk = true; def.berserkTimer = 300; }
                
                // Spawn Particles
                for(let i=0; i<8; i++) particles.push(new Particle(def.x + 30, def.y + 40, "yellow"));
                
                def.velX = atk.side === "left" ? 20 : -20;
                if (def.hp <= 0) { 
                    winner = atk.side; 
                    if(!atk.isAI) { stats.gold += 100; save(); }
                }
            }
        }

        function gameLoop() {
            ctx.clearRect(0, 0, 800, 400);
            if (gameState === "PLAY") {
                if (winner) {
                    ctx.fillStyle = "white"; ctx.font = "40px Arial";
                    ctx.fillText(winner + " WINS! +100 Gold", 200, 200);
                    setTimeout(() => { gameState = "MENU"; menu.style.display = "flex"; winner = null; }, 3000);
                } else {
                    // P1 Control
                    let s = p1.isBerserk ? p1.speed * 1.5 : p1.speed;
                    if (keys['KeyA']) p1.x -= s; if (keys['KeyD']) p1.x += s;
                    if (keys['Space']) { checkHit(p1, cpu); keys['Space'] = false; }

                    // AI Basic
                    if (cpu.x > p1.x + 70) cpu.x -= cpu.speed;
                    if (Math.random() < 0.05) checkHit(cpu, p1);

                    p1.update(); cpu.update();
                    p1.draw(); cpu.draw();
                    particles.forEach((p, i) => { p.update(); p.draw(); if(p.alpha <= 0) particles.splice(i, 1); });
                }
            }
            requestAnimationFrame(gameLoop);
        }
        gameLoop();
    </script>
</body>
</html>
