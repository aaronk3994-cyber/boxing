<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>2 Player Fighting Game</title>
<style>
  body {
    background: #111;
    color: white;
    text-align: center;
    font-family: Arial;
  }
  canvas {
    background: linear-gradient(#222, #555);
    border: 4px solid white;
  }
</style>
</head>
<body>

<h1>ü•ä 2 Player Fighting Game</h1>
<canvas id="game" width="900" height="450"></canvas>
<p id="info">Select characters ‚Äî Player 1 (A/D), Player 2 (‚Üê/‚Üí), SPACE to start</p>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

let gameState = "select";

const characters = [
  { name: "Boxer", color: "red" },
  { name: "Kickboxer", color: "blue" },
  { name: "Ninja", color: "purple" },
  { name: "Robot", color: "lime" }
];

let p1Choice = 0;
let p2Choice = 1;

class Fighter {
  constructor(x, char) {
    this.x = x;
    this.baseY = 350;
    this.y = this.baseY;
    this.vy = 0;
    this.width = 50;
    this.height = 90;
    this.health = 100;
    this.char = char;
    this.cooldown = 0;
    this.attackFrame = 0;
    this.hitFlash = 0;
  }

  jump() {
    if (this.y === this.baseY) this.vy = -18;
  }

  attack(target, dmg, range) {
    if (this.cooldown === 0 &&
        Math.abs(this.x - target.x) < range) {
      target.health -= dmg;
      target.hitFlash = 6;
      this.cooldown = 20;
      this.attackFrame = 6;
    }
  }

  update() {
    this.vy += 1.2;
    this.y += this.vy;
    if (this.y > this.baseY) {
      this.y = this.baseY;
      this.vy = 0;
    }

    if (this.cooldown > 0) this.cooldown--;
    if (this.attackFrame > 0) this.attackFrame--;
    if (this.hitFlash > 0) this.hitFlash--;
  }

  draw() {
    const bounce = Math.sin(Date.now() / 150) * 3;
    ctx.fillStyle = this.hitFlash ? "white" : this.char.color;

    // Body
    ctx.fillRect(this.x, this.y - this.height + bounce,
                  this.width, this.height);

    // Arm animation
    if (this.attackFrame) {
      ctx.fillRect(this.x + this.width,
                   this.y - this.height / 2,
                   20, 10);
    }
  }
}

let p1, p2;

function drawHealth() {
  ctx.fillStyle = "red";
  ctx.fillRect(20, 20, p1.health * 2, 20);
  ctx.fillStyle = "blue";
  ctx.fillRect(660, 20, p2.health * 2, 20);
}

function drawSelectScreen() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.font = "24px Arial";

  characters.forEach((c, i) => {
    ctx.fillStyle = c.color;
    ctx.fillRect(150 + i * 150, 200, 50, 80);

    if (i === p1Choice) {
      ctx.strokeStyle = "red";
      ctx.strokeRect(145 + i * 150, 195, 60, 90);
    }
    if (i === p2Choice) {
      ctx.strokeStyle = "blue";
      ctx.strokeRect(145 + i * 150, 195, 60, 90);
    }
  });

  if (keys["a"]) p1Choice = (p1Choice + characters.length - 1) % characters.length;
  if (keys["d"]) p1Choice = (p1Choice + 1) % characters.length;
  if (keys["ArrowLeft"]) p2Choice = (p2Choice + characters.length - 1) % characters.length;
  if (keys["ArrowRight"]) p2Choice = (p2Choice + 1) % characters.length;

  if (keys[" "]) {
    p1 = new Fighter(150, characters[p1Choice]);
    p2 = new Fighter(700, characters[p2Choice]);
    gameState = "fight";
    document.getElementById("info").innerText = "FIGHT!";
  }
}

function fightLoop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Player 1
  if (keys["a"]) p1.x -= 5;
  if (keys["d"]) p1.x += 5;
  if (keys["q"]) p1.jump();
  if (keys["w"]) p1.attack(p2, 6, 60);
  if (keys["s"]) p1.attack(p2, 9, 70);

  // Player 2
  if (keys["ArrowLeft"]) p2.x -= 5;
  if (keys["ArrowRight"]) p2.x += 5;
  if (keys["/"]) p2.jump();
  if (keys["ArrowUp"]) p2.attack(p1, 6, 60);
  if (keys["ArrowDown"]) p2.attack(p1, 9, 70);

  p1.update();
  p2.update();

  p1.draw();
  p2.draw();
  drawHealth();

  if (p1.health <= 0 || p2.health <= 0) {
    ctx.font = "40px Arial";
    ctx.fillStyle = "white";
    ctx.fillText(
      p1.health <= 0 ? "PLAYER 2 WINS!" : "PLAYER 1 WINS!",
      260, 230
    );
    return;
  }

  requestAnimationFrame(gameLoop);
}

function gameLoop() {
  if (gameState === "select") drawSelectScreen();
  else fightLoop();
  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>

</body>
</html>
